<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:local="clr-namespace:Informatics.Appetite"
             x:Class="Informatics.Appetite.Pages.RecipeDetailsPage"
             Title="Recipe Details"
             BackgroundColor="White">
    <ScrollView>
        <VerticalStackLayout Spacing="15" Padding="20">
            <!-- Recipe Name -->
            <Label Text="{Binding Recipe.Name, Mode=TwoWay}"
                   FontAttributes="Bold"
                   FontSize="48"
                   TextColor="Black"
                   Margin="0,0,0,10"/>
            
            <!-- Vertical Layout for Description and Details -->
            <VerticalStackLayout Spacing="40">
                <!-- Recipe Description -->
                <Label Text="{Binding Recipe.ParsedData.description}"
                       FontAttributes="Bold"
                       FontSize="18"
                       TextColor="Black"
                       HorizontalOptions="Fill"
                       VerticalOptions="Start"
                       LineBreakMode="WordWrap"/>
                
                <!-- Grid for Difficulty, Cooking Time, and Servings -->
                <Grid ColumnDefinitions="*,*,*" HorizontalOptions="Fill">
                    <!-- Difficulty -->
                    <VerticalStackLayout Spacing="5" HorizontalOptions="Center" Grid.Column="0">
                        <Image Source="hat_chef.png" WidthRequest="40" HeightRequest="40" HorizontalOptions="Center"/>
                        <Label Text="{Binding Recipe.DifficultyLevel}"
                            FontSize="18"
                            TextColor="Black"
                            HorizontalOptions="Center"/>
                    </VerticalStackLayout>

                    <!-- Cooking Time -->
                    <VerticalStackLayout Spacing="5" HorizontalOptions="Center" Grid.Column="1">
                        <Image Source="clock_three.png" WidthRequest="40" HeightRequest="40" HorizontalOptions="Center"/>
                        <Label Text="{Binding Recipe.CookingTime, StringFormat ='{0} minutes'}"
                            FontSize="18"
                            TextColor="Black"
                            HorizontalOptions="Center"/>
                    </VerticalStackLayout>

                    <!-- Servings -->
                    <VerticalStackLayout Spacing="5" HorizontalOptions="Center" Grid.Column="2">
                        <Image Source="plate_utensils.png" WidthRequest="40" HeightRequest="40" HorizontalOptions="Center"/>
                        <Label Text="{Binding Recipe.Servings, StringFormat='{0} portions'}"
                            FontSize="18"
                            TextColor="Black"
                            HorizontalOptions="Center"/>
                    </VerticalStackLayout>
                </Grid>
            </VerticalStackLayout>

            <!-- Grid for Ingredients and Cooking Instructions -->
            <Grid ColumnDefinitions="*,*">
                <!-- Ingredient List (Read-Only) -->
                <VerticalStackLayout Spacing="15" Padding="10" Grid.Column="0">
                    <Label Text="Ingredients"
                           FontAttributes="Bold"
                           FontSize="24"
                           TextColor="Black"/>
                    <CollectionView ItemsSource="{Binding RecipeIngredients}"
                                    SelectionMode="None"
                                    VerticalOptions="Fill"
                                    ItemsUpdatingScrollMode="KeepItemsInView">
                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <Border Stroke="#E0E0E0" StrokeThickness="1" Padding="10" Margin="5">
                                    <Grid ColumnDefinitions="*,Auto,Auto" RowDefinitions="Auto">
                                        <!-- Checkmark Icon (Visible when IsAvailable is true) -->
                                        <Image Grid.Row="0" Grid.Column="2"
                                            Source="checkmark.png"
                                            WidthRequest="20" HeightRequest="20"
                                            Margin="10,0,0,0"
                                            IsVisible="{Binding IsAvailable}"/>
                                        <!-- Ingredient Name -->
                                        <Label Grid.Row="0" Grid.Column="0"
                                            Text="{Binding Ingredient.Name}"
                                            FontAttributes="Bold"
                                            FontSize="16"
                                            TextColor="Black"/>
                                        
                                        <!-- Ingredient Amount -->
                                        <Label Grid.Row="0" Grid.Column="1">
                                            <Label.Text>
                                                <MultiBinding StringFormat="{}{0} {1}">
                                                    <Binding Path="Amount" />
                                                    <Binding Path="Ingredient.Unit" />
                                                </MultiBinding>
                                            </Label.Text>
                                        </Label>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>

                        <!-- Empty View -->
                        <CollectionView.EmptyView>
                            <Label Text="No ingredients found in this recipe."
                                HorizontalOptions="Center"
                                VerticalOptions="Center"
                                FontSize="14"
                                FontAttributes="Italic"
                                TextColor="Gray"/>
                        </CollectionView.EmptyView>
                    </CollectionView>
                </VerticalStackLayout>

                <!-- Cooking Instructions -->
                <VerticalStackLayout Spacing="15" Padding="10" Grid.Column="1">
                    <Label Text="Cooking Instructions"
                           FontAttributes="Bold"
                           FontSize="24"
                           TextColor="Black"/>
                    <CollectionView ItemsSource="{Binding Recipe.ParsedData.steps}"
                                  SelectionMode="None">
                        <CollectionView.ItemsLayout>
                            <LinearItemsLayout Orientation="Vertical" ItemSpacing="10"/>
                        </CollectionView.ItemsLayout>
                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <StackLayout>
                                    <Label Text="{Binding ., StringFormat='{0}. {1}'}"
                                           FontSize="16"
                                           TextColor="Black"/>
                                </StackLayout>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                        <CollectionView.EmptyView>
                            <VerticalStackLayout>
                                <Label Text="No cooking instructions available."
                                       HorizontalOptions="Center"
                                       VerticalOptions="Center"
                                       FontSize="14"
                                       FontAttributes="Italic"
                                       TextColor="Gray"/>
                                <Label Text="{Binding Recipe.Data}"
                                       HorizontalOptions="Center"
                                       VerticalOptions="Center"
                                       FontSize="12"
                                       TextColor="Gray"/>
                            </VerticalStackLayout>
                        </CollectionView.EmptyView>
                    </CollectionView>
                </VerticalStackLayout>
            </Grid>
        </VerticalStackLayout>
    </ScrollView>
</ContentPage>